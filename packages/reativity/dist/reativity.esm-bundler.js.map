{"version":3,"file":"reativity.esm-bundler.js","sources":["../../shared/src/index.ts","../src/baseHandlers.ts","../src/reative.ts"],"sourcesContent":["export const isObject = (val: unknown): val is Record<any, any> => val !== null && typeof val === 'object';\n","import { isObject } from '@vue/shared';\nimport { readonly, reative } from './reative';\n// 处理get\nfunction createGetter(isReadonly = false, shallow = false) {\n  return function get(target, key, receiver) {\n    console.log('触发get');\n    const res = Reflect.get(target, key, receiver); // target[key]\n    // 不是只读\n    if (!isReadonly) {\n      // 收集依赖\n    }\n    // 浅\n    if (shallow) {\n      return res;\n    }\n    // key是一个对象,递归，懒代理，即当访问下一层对象才开始进行拦截，必须被使用\n    if (isObject(res)) {\n      return isReadonly ? readonly(res) : reative(res);\n    }\n    return res;\n  };\n}\n\n// 柯里化，根据不同参数处理逻辑\n// 处理get\nconst get = /*#__PURE__*/ createGetter(); // 深度非只读\nconst shallowGet = /*#__PURE__*/ createGetter(false, true); // 非只读 浅\nconst readonlyGet = /*#__PURE__*/ createGetter(true); // 只读 深度\nconst shallowReadonlyGet = /*#__PURE__*/ createGetter(true, true); // 只读 浅\n\n// 处理set,是否浅\nfunction createSetter(shallow = false) {\n  return function set(target, key, value, receiver) {\n    const result = Reflect.set(target, key, value, receiver);\n    return result;\n  };\n}\nconst set = /*#__PURE__*/ createSetter();\nconst shallowSet = /*#__PURE__*/ createSetter(true);\n// 全部代理\nexport const reativeHandlers = {\n  get,\n  set\n};\n// 数据第一层代理\nexport const shallowReactiveHandlers = {\n  get: shallowGet,\n  set: shallowSet\n};\n// 全部只读\nexport const readonlyHandlers = {\n  get: readonlyGet,\n  set: (target, key, value) => {\n    console.error('不可以修改key，只读全部');\n  }\n};\n// 第一层只读\nexport const shallowReativeHandlers = {\n  get: shallowReadonlyGet,\n  set: (target, key, value) => {\n    console.error('不可以修改key只读一层');\n  }\n};\n","import { isObject } from '@vue/shared';\nimport { reativeHandlers,shallowReactiveHandlers,readonlyHandlers,shallowReativeHandlers } from './baseHandlers';\nexport function reative(target) {\n  return createReativeObj(target, false, reativeHandlers);\n}\nexport function shallowReactive(target) {\n  return createReativeObj(target, false, shallowReactiveHandlers);\n}\nexport function readonly(target) {\n  return createReativeObj(target, true, readonlyHandlers);\n}\nexport function shallowReative(target) {\n  return createReativeObj(target, true, shallowReativeHandlers);\n}\n\n// 核心是proxy 采用柯里化根据不同参数处理\n// 创建一个表来存储当前代理的对象\nconst reativeMap = new WeakMap(); // key必须为一个对象 自动垃圾回收\nconst readOnlyMap = new WeakMap(); // key必须为一个对象 自动垃圾回收\n// 创建reative对象，返回一个proxy\nfunction createReativeObj(target, isReadonly, baseHandlers) {\n  if (!isObject(target)) {\n    return target;\n  }\n  // 通过是否只读来创建不同map\n  const proxyMap = isReadonly ? readOnlyMap : reativeMap;\n  const proxyEs = proxyMap.get(target);\n  // 如果已经创建过，就返回已经创建的代理\n  if (proxyEs) {\n    return proxyEs;\n  }\n  // 如果没有，将代理存入表中，并返回\n  const proxy = new Proxy(target, baseHandlers);\n  proxyMap.set(target, proxy);\n  return proxy;\n}\n"],"names":[],"mappings":"AAAO,MAAM,QAAQ,GAAG,CAAC,GAAY,KAA8B,GAAG,KAAK,IAAI,IAAI,OAAO,GAAG,KAAK,QAAQ;;ACE1G;AACA,SAAS,YAAY,CAAC,UAAU,GAAG,KAAK,EAAE,OAAO,GAAG,KAAK;IACvD,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ;QACvC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACrB,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;;QAM/C,IAAI,OAAO,EAAE;YACX,OAAO,GAAG,CAAC;SACZ;;QAED,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;YACjB,OAAO,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC;SAClD;QACD,OAAO,GAAG,CAAC;KACZ,CAAC;AACJ,CAAC;AAED;AACA;AACA,MAAM,GAAG,iBAAiB,YAAY,EAAE,CAAC;AACzC,MAAM,UAAU,iBAAiB,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;AAC3D,MAAM,WAAW,iBAAiB,YAAY,CAAC,IAAI,CAAC,CAAC;AACrD,MAAM,kBAAkB,iBAAiB,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAElE;AACA,SAAS,YAAY,CAAC,OAAO,GAAG,KAAK;IACnC,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ;QAC9C,MAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;QACzD,OAAO,MAAM,CAAC;KACf,CAAC;AACJ,CAAC;AACD,MAAM,GAAG,iBAAiB,YAAY,EAAE,CAAC;AACzC,MAAM,UAAU,iBAAiB,YAAY,CAAC,IAAI,CAAC,CAAC;AACpD;AACO,MAAM,eAAe,GAAG;IAC7B,GAAG;IACH,GAAG;CACJ,CAAC;AACF;AACO,MAAM,uBAAuB,GAAG;IACrC,GAAG,EAAE,UAAU;IACf,GAAG,EAAE,UAAU;CAChB,CAAC;AACF;AACO,MAAM,gBAAgB,GAAG;IAC9B,GAAG,EAAE,WAAW;IAChB,GAAG,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK;QACtB,OAAO,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC;KAChC;CACF,CAAC;AACF;AACO,MAAM,sBAAsB,GAAG;IACpC,GAAG,EAAE,kBAAkB;IACvB,GAAG,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK;QACtB,OAAO,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;KAC/B;CACF;;SC5De,OAAO,CAAC,MAAM;IAC5B,OAAO,gBAAgB,CAAC,MAAM,EAAE,KAAK,EAAE,eAAe,CAAC,CAAC;AAC1D,CAAC;SACe,eAAe,CAAC,MAAM;IACpC,OAAO,gBAAgB,CAAC,MAAM,EAAE,KAAK,EAAE,uBAAuB,CAAC,CAAC;AAClE,CAAC;SACe,QAAQ,CAAC,MAAM;IAC7B,OAAO,gBAAgB,CAAC,MAAM,EAAE,IAAI,EAAE,gBAAgB,CAAC,CAAC;AAC1D,CAAC;SACe,cAAc,CAAC,MAAM;IACnC,OAAO,gBAAgB,CAAC,MAAM,EAAE,IAAI,EAAE,sBAAsB,CAAC,CAAC;AAChE,CAAC;AAED;AACA;AACA,MAAM,UAAU,GAAG,IAAI,OAAO,EAAE,CAAC;AACjC,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAC;AAClC;AACA,SAAS,gBAAgB,CAAC,MAAM,EAAE,UAAU,EAAE,YAAY;IACxD,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;QACrB,OAAO,MAAM,CAAC;KACf;;IAED,MAAM,QAAQ,GAAG,UAAU,GAAG,WAAW,GAAG,UAAU,CAAC;IACvD,MAAM,OAAO,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;;IAErC,IAAI,OAAO,EAAE;QACX,OAAO,OAAO,CAAC;KAChB;;IAED,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;IAC9C,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;IAC5B,OAAO,KAAK,CAAC;AACf;;;;"}